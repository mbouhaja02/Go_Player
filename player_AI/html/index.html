<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>646d4a70e8804f2e9ecf8d2db207eeb7</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="apprenez-une-heuristique-pour-le-go" class="cell markdown"
id="BzTfCbHzN1Wj">
<h1>Apprenez une heuristique pour le Go</h1>
<p>Dans ce <strong>TP noté</strong>, vous devrez déployer des methodes
d'apprentissage automatique permettant d'évaluer la qualité de plateaux
de GO.</p>
<p>Pour cela, vous disposerez de 21854 exemples de plateau de Go, tous
générés par <code>gnugo</code> après quelques coups contre lui même avec
un niveau de difficulté de 0. Par chaque plateau, nous avons lancé 100
matchs de gnugo contre lui même, toujours avec un niveau 0, et compté le
nombre de victoires de noir et de blanc depuis ce plateau.</p>
<p>A noter, chaque "rollout" (un rollout et un déroulement possible du
match depuis le plateau de référence) correspond à des mouvements
choisis aléatoirement parmis les 10 meilleurs mouvements possibles, en
biasant le choix aléatoire par la qualité prédite du mouvement par gnugo
(les meilleurs mouvements ont une plus forte probabilité d'être
tirés).</p>
<p>Les données dont vous disposez sont brutes. Ce sera à vous de
proposer un format adéquat pour utiliser ces données en entrée de votre
réseau neuronal.</p>
<h2 id="comment-sera-évalué-votre-modèle-">Comment sera évalué votre
modèle ?</h2>
<p>Nous vous fournirons 6h avant la date de rendu un nouveau fichier
contenant 1000 nouveaux exemples, qui ne contiendront pas les champs
<code>black_wins</code>, <code>white_wins</code>,
<code>black_points</code> et <code>white_points</code>. Vous devrez
laisser, dans votre dépot de projet (votre dépot GIT sous un
sous-répertoire ML) un fichier texte nommé
<code>my_predictions.txt</code> ayant une prédiction par ligne (un
simple flottant) qui donnera, dans le même ordre de la liste des
exemples les scores que vous prédisez pour chacune des entrées du
fichier que nous vous aurons donné. ** Les scores seront donnés sous
forme d'un flottant, entre 0 et 1, donnant la probabilité de victoire de
noir sur le plateau considéré **. Il faudra laisser, dans votre feuille
notebook (voir tout en dessous) la cellule Python qui aura créé ce
fichier, pour que l'on puisse éventuellement refaire vos
prédictions.</p>
<p>Bien entendu, vous nous rendrez également votre feuille jupyter
<strong>sous deux formats</strong>, à la fois le fichier
<code>.ipynb</code> et le fichier <code>.html</code> nous permettant de
lire ce que vous avez fait, sans forcément relancer la feuille. Nous
prendrons en compte les résultats obtenus sur les prédictions mais aussi
le contenu de vos notebooks jupyter.</p>
<h3 id="comment-sera-noté-ce-tp-">Comment sera noté ce TP ?</h3>
<p><strong>Il s'agit d'un TP noté (et non pas d'un projet), donc il ne
faudra pas y passer trop de temps</strong>. Nous attendons des
prédictions correctes mais surtout des choix justifiés dans la feuille.
Votre feuille notebook sera le plus important pour la notation
(n'hésitez pas à mettre des cellules de texte pour expliquer pourquoi
vous avez été amenés à faire certains choix). Ainsi, il serait bien
d'avoir, par exemple, les données (graphiques ou autre) qui permettent
de comprendre comment vous avez évité l'overfitting.</p>
<p>Le fichier de vos prédiction sera évalué en se basant sur la qualité
de vos prédictions. Nous mesurerons par exemple (juste pour vous donner
une idée) le nombre d'exemples dont votre prédiction donnera la bonne
valeur à 5%, 10%, 20%, 35%, 50% pour estimer sa qualité.</p>
<h2 id="mise-en-route-">Mise en route !</h2>
<p>Voyons comment lire les données</p>
</section>
<div class="cell code" data-execution_count="1"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="IQyK1qLZN1Wl" data-outputId="5924f94d-5257-4361-8e84-e1f7dc050685">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import du fichier d&#39;exemples</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_raw_data_go():</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39; Returns the set of samples from the local file or download it if it does not exists&#39;&#39;&#39;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> gzip, os.path</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> json</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    raw_samples_file <span class="op">=</span> <span class="st">&quot;samples-8x8.json.gz&quot;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.isfile(raw_samples_file):</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;File&quot;</span>, raw_samples_file, <span class="st">&quot;not found, I am downloading it...&quot;</span>, end<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> urllib.request</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        urllib.request.urlretrieve (<span class="st">&quot;https://www.labri.fr/perso/lsimon/static/inge2-ia/samples-8x8.json.gz&quot;</span>, <span class="st">&quot;samples-8x8.json.gz&quot;</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot; Done&quot;</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> gzip.<span class="bu">open</span>(<span class="st">&quot;samples-8x8.json.gz&quot;</span>) <span class="im">as</span> fz:</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(fz.read().decode(<span class="st">&quot;utf-8&quot;</span>))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> get_raw_data_go()</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;We have&quot;</span>, <span class="bu">len</span>(data),<span class="st">&quot;examples&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>We have 41553 examples
</code></pre>
</div>
</div>
<section id="compréhension-des-données-de-chaque-entrée"
class="cell markdown" id="WaSjA3uPN1Wn">
<h2>Compréhension des données de chaque entrée</h2>
<p>Voici une description de chaque exemple</p>
</section>
<div class="cell code" data-execution_count="2"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="oCKzso-aN1Wn" data-outputId="96be7d06-ba1a-4c17-9ae2-2970695125f5">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summary_of_example(data, sample_nb):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39; Gives you some insights about a sample number&#39;&#39;&#39;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    sample <span class="op">=</span> data[sample_nb]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Sample&quot;</span>, sample_nb)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Données brutes en format JSON:&quot;</span>, sample)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;The sample was obtained after&quot;</span>, sample[<span class="st">&quot;depth&quot;</span>], <span class="st">&quot;moves&quot;</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;The successive moves were&quot;</span>, sample[<span class="st">&quot;list_of_moves&quot;</span>])</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;After these moves and all the captures, there was black stones at the following position&quot;</span>, sample[<span class="st">&quot;black_stones&quot;</span>])</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;After these moves and all the captures, there was white stones at the following position&quot;</span>, sample[<span class="st">&quot;white_stones&quot;</span>])</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Number of rollouts (gnugo games played against itself from this position):&quot;</span>, sample[<span class="st">&quot;rollouts&quot;</span>])</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Over these&quot;</span>, sample[<span class="st">&quot;rollouts&quot;</span>], <span class="st">&quot;games, black won&quot;</span>, sample[<span class="st">&quot;black_wins&quot;</span>], <span class="st">&quot;times with&quot;</span>, sample[<span class="st">&quot;black_points&quot;</span>], <span class="st">&quot;total points over all this winning games&quot;</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Over these&quot;</span>, sample[<span class="st">&quot;rollouts&quot;</span>], <span class="st">&quot;games, white won&quot;</span>, sample[<span class="st">&quot;white_wins&quot;</span>], <span class="st">&quot;times with&quot;</span>, sample[<span class="st">&quot;white_points&quot;</span>], <span class="st">&quot;total points over all this winning games&quot;</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>summary_of_example(data,<span class="dv">10</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Sample 10

Données brutes en format JSON: {&#39;depth&#39;: 39, &#39;list_of_moves&#39;: [&#39;E5&#39;, &#39;C5&#39;, &#39;D3&#39;, &#39;F6&#39;, &#39;E3&#39;, &#39;E6&#39;, &#39;F5&#39;, &#39;D6&#39;, &#39;G6&#39;, &#39;G7&#39;, &#39;B4&#39;, &#39;C4&#39;, &#39;G5&#39;, &#39;B5&#39;, &#39;C3&#39;, &#39;B3&#39;, &#39;B2&#39;, &#39;A4&#39;, &#39;D4&#39;, &#39;A2&#39;, &#39;C1&#39;, &#39;H7&#39;, &#39;B1&#39;, &#39;A3&#39;, &#39;H6&#39;, &#39;D5&#39;, &#39;A1&#39;, &#39;F7&#39;, &#39;D2&#39;, &#39;E8&#39;, &#39;E4&#39;, &#39;E7&#39;, &#39;F2&#39;, &#39;G8&#39;, &#39;F3&#39;, &#39;A5&#39;, &#39;G4&#39;, &#39;PASS&#39;, &#39;H4&#39;], &#39;black_stones&#39;: [&#39;G6&#39;, &#39;H6&#39;, &#39;E5&#39;, &#39;F5&#39;, &#39;G5&#39;, &#39;D4&#39;, &#39;E4&#39;, &#39;G4&#39;, &#39;H4&#39;, &#39;C3&#39;, &#39;D3&#39;, &#39;E3&#39;, &#39;F3&#39;, &#39;B2&#39;, &#39;D2&#39;, &#39;F2&#39;, &#39;A1&#39;, &#39;B1&#39;, &#39;C1&#39;], &#39;white_stones&#39;: [&#39;E8&#39;, &#39;G8&#39;, &#39;E7&#39;, &#39;F7&#39;, &#39;G7&#39;, &#39;H7&#39;, &#39;D6&#39;, &#39;E6&#39;, &#39;F6&#39;, &#39;A5&#39;, &#39;B5&#39;, &#39;C5&#39;, &#39;D5&#39;, &#39;A4&#39;, &#39;C4&#39;, &#39;A3&#39;, &#39;B3&#39;, &#39;A2&#39;], &#39;rollouts&#39;: 100, &#39;black_wins&#39;: 0, &#39;black_points&#39;: 0, &#39;white_wins&#39;: 0, &#39;white_points&#39;: 0}

The sample was obtained after 39 moves
The successive moves were [&#39;E5&#39;, &#39;C5&#39;, &#39;D3&#39;, &#39;F6&#39;, &#39;E3&#39;, &#39;E6&#39;, &#39;F5&#39;, &#39;D6&#39;, &#39;G6&#39;, &#39;G7&#39;, &#39;B4&#39;, &#39;C4&#39;, &#39;G5&#39;, &#39;B5&#39;, &#39;C3&#39;, &#39;B3&#39;, &#39;B2&#39;, &#39;A4&#39;, &#39;D4&#39;, &#39;A2&#39;, &#39;C1&#39;, &#39;H7&#39;, &#39;B1&#39;, &#39;A3&#39;, &#39;H6&#39;, &#39;D5&#39;, &#39;A1&#39;, &#39;F7&#39;, &#39;D2&#39;, &#39;E8&#39;, &#39;E4&#39;, &#39;E7&#39;, &#39;F2&#39;, &#39;G8&#39;, &#39;F3&#39;, &#39;A5&#39;, &#39;G4&#39;, &#39;PASS&#39;, &#39;H4&#39;]
After these moves and all the captures, there was black stones at the following position [&#39;G6&#39;, &#39;H6&#39;, &#39;E5&#39;, &#39;F5&#39;, &#39;G5&#39;, &#39;D4&#39;, &#39;E4&#39;, &#39;G4&#39;, &#39;H4&#39;, &#39;C3&#39;, &#39;D3&#39;, &#39;E3&#39;, &#39;F3&#39;, &#39;B2&#39;, &#39;D2&#39;, &#39;F2&#39;, &#39;A1&#39;, &#39;B1&#39;, &#39;C1&#39;]
After these moves and all the captures, there was white stones at the following position [&#39;E8&#39;, &#39;G8&#39;, &#39;E7&#39;, &#39;F7&#39;, &#39;G7&#39;, &#39;H7&#39;, &#39;D6&#39;, &#39;E6&#39;, &#39;F6&#39;, &#39;A5&#39;, &#39;B5&#39;, &#39;C5&#39;, &#39;D5&#39;, &#39;A4&#39;, &#39;C4&#39;, &#39;A3&#39;, &#39;B3&#39;, &#39;A2&#39;]
Number of rollouts (gnugo games played against itself from this position): 100
Over these 100 games, black won 0 times with 0 total points over all this winning games
Over these 100 games, white won 0 times with 0 total points over all this winning games
</code></pre>
</div>
</div>
<section id="données-en-entrée-et-en-sortie-de-votre-modèle-final"
class="cell markdown" id="e-AdNZZEN1Wo">
<h2>Données en entrée et en sortie de votre modèle final</h2>
<p>Même si en interne, votre modèle va manipuler des tenseurs en numpy,
vous devrez construire une boite noire qui prendra en entrée les données
dans le style du JSON ci-dessous. Typiquement, vous aurez le même genre
de fichier avec seulement les champs <code>black_stones</code>,
<code>white_stones</code>, <code>depth</code> et
<code>list_of_moves</code> de renseignées. Vous devrez utiliser ces
champs, dont notemment les coordonnées des pierres noires et blanches et
donner le pourcentage de chance pour noir de gagner depuis cette
position.</p>
<p>Ainsi, pour l'exemple <code>i</code> :</p>
<ul>
<li>Vous pourrez prendez en entree <code>data[i]["black_stones"]</code>
et <code>data[i]["white_stones"]</code> (vous pouvez, si vous le
souhaitez, prendre en compte également <code>list_of_moves</code> ou
tout autre donnée que vous calculerez vous-même (mais qui ne se basera
évidemment pas sur les données que vous n'aurez pas lors de
l'évaluation).</li>
<li>Vous devrez prédire simplement
<code>data[i]["black_wins"]/data[i]["rollouts"]</code> en float (donc
une valeur entre 0 et 1).</li>
</ul>
<p>Encore une fois, <strong>attention</strong> : en interne, il faudra
absolument construire vos données formattées en matrices numpy pour
faire votre entrainement. On vous demande juste ici d'écrire comment
vous faites ces transformations, pour comprendre ce que vous avez décidé
de mettre en entrée du réseau.</p>
<p>Voici par exemple le modèle de la fonction qui pourra être appelée,
au final :</p>
</section>
<div class="cell code" data-execution_count="4"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="kxeEQ89HN1Wp" data-outputId="9956cdb6-ec15-4085-b917-bf89c169bf3b">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> load_model</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume ConvNet and other functions (get_data, name_to_coord) are already defined as provided earlier</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the Keras model (assuming it was trained and saved as &#39;my_model.h5&#39;)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> torch.load(<span class="st">&#39;death.pth&#39;</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> name_to_coord(s):</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> s <span class="op">!=</span> <span class="st">&quot;PASS&quot;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    indexLetters <span class="op">=</span> {<span class="st">&#39;A&#39;</span>: <span class="dv">0</span>, <span class="st">&#39;B&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;C&#39;</span>: <span class="dv">2</span>, <span class="st">&#39;D&#39;</span>: <span class="dv">3</span>, <span class="st">&#39;E&#39;</span>: <span class="dv">4</span>, <span class="st">&#39;F&#39;</span>: <span class="dv">5</span>, <span class="st">&#39;G&#39;</span>: <span class="dv">6</span>, <span class="st">&#39;H&#39;</span>: <span class="dv">7</span>}</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> indexLetters[s[<span class="dv">0</span>]]</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    lin <span class="op">=</span> <span class="bu">int</span>(s[<span class="dv">1</span>:]) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> col, lin</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prepare_input(black_stones, white_stones):</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.zeros((<span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> stone <span class="kw">in</span> black_stones:</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        col, lin <span class="op">=</span> name_to_coord(stone)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        x[<span class="dv">0</span>, col, lin] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> stone <span class="kw">in</span> white_stones:</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        col, lin <span class="op">=</span> name_to_coord(stone)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        x[<span class="dv">1</span>, col, lin] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> position_predict(black_stones, white_stones):</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Préparer les données d&#39;entrée</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> prepare_input(black_stones, white_stones)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> torch.tensor(x, dtype<span class="op">=</span>torch.float32).unsqueeze(<span class="dv">0</span>)  <span class="co"># Ajouter une dimension pour le batch</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Faire une prédiction avec le modèle PyTorch</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        prediction <span class="op">=</span> model(x)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prediction</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Par exemple, nous pourrons appeler votre prédiction ainsi</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Prediction this sample:&quot;</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>summary_of_example(data, <span class="dv">10</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>prediction <span class="op">=</span> position_predict(data[<span class="dv">10</span>][<span class="st">&quot;black_stones&quot;</span>], data[<span class="dv">10</span>][<span class="st">&quot;white_stones&quot;</span>])</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;You predicted&quot;</span>, prediction, <span class="st">&quot;and the actual target was&quot;</span>, data[<span class="dv">10</span>][<span class="st">&quot;black_wins&quot;</span>]<span class="op">/</span>data[<span class="dv">10</span>][<span class="st">&quot;rollouts&quot;</span>])</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Ainsi, pour le rendu, en admettant que newdata soit la structure de données issue du json contenant les nouvelles données que</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="co"># l&#39;on vous donnera 24h avant la fin, vous pourrez construire le fichier resultat ainsi</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_result_file(newdata):</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39; Exemple de méthode permettant de générer le fichier de resultats demandés. &#39;&#39;&#39;</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    resultat  <span class="op">=</span> [position_predict(d[<span class="st">&quot;black_stones&quot;</span>], d[<span class="st">&quot;white_stones&quot;</span>]) <span class="cf">for</span> d <span class="kw">in</span> newdata]</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;my_predictions.txt&quot;</span>, <span class="st">&quot;w&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> p <span class="kw">in</span> resultat:</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>            f.write(<span class="bu">str</span>(p)<span class="op">+</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>create_result_file(data)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>2024-05-17 19:55:31.199791: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2024-05-17 19:55:31.224486: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2024-05-17 19:55:31.651669: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
</code></pre>
</div>
<div class="output error" data-ename="FileNotFoundError"
data-evalue="[Errno 2] No such file or directory: &#39;death.pth&#39;">
<pre><code>---------------------------------------------------------------------------
FileNotFoundError                         Traceback (most recent call last)
Cell In[4], line 10
      5 from keras.models import load_model
      7 # Assume ConvNet and other functions (get_data, name_to_coord) are already defined as provided earlier
      8 
      9 # Load the Keras model (assuming it was trained and saved as &#39;my_model.h5&#39;)
---&gt; 10 model = torch.load(&#39;death.pth&#39;)
     12 def name_to_coord(s):
     13     assert s != &quot;PASS&quot;

File ~/.venv/lib/python3.12/site-packages/torch/serialization.py:997, in load(f, map_location, pickle_module, weights_only, mmap, **pickle_load_args)
    994 if &#39;encoding&#39; not in pickle_load_args.keys():
    995     pickle_load_args[&#39;encoding&#39;] = &#39;utf-8&#39;
--&gt; 997 with _open_file_like(f, &#39;rb&#39;) as opened_file:
    998     if _is_zipfile(opened_file):
    999         # The zipfile reader is going to advance the current file position.
   1000         # If we want to actually tail call to torch.jit.load, we need to
   1001         # reset back to the original position.
   1002         orig_position = opened_file.tell()

File ~/.venv/lib/python3.12/site-packages/torch/serialization.py:444, in _open_file_like(name_or_buffer, mode)
    442 def _open_file_like(name_or_buffer, mode):
    443     if _is_path(name_or_buffer):
--&gt; 444         return _open_file(name_or_buffer, mode)
    445     else:
    446         if &#39;w&#39; in mode:

File ~/.venv/lib/python3.12/site-packages/torch/serialization.py:425, in _open_file.__init__(self, name, mode)
    424 def __init__(self, name, mode):
--&gt; 425     super().__init__(open(name, mode))

FileNotFoundError: [Errno 2] No such file or directory: &#39;death.pth&#39;
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="231"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:944}"
id="sIGMJhBUN1Wq" data-outputId="5417c7ef-dbca-4891-ed17-e3d2c6d74968">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Relationship between the depth of the board and the chance for black to win&quot;</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>plt.plot([sample[<span class="st">&quot;black_wins&quot;</span>] <span class="cf">for</span> sample <span class="kw">in</span> data],[sample[<span class="st">&quot;depth&quot;</span>] <span class="cf">for</span> sample <span class="kw">in</span> data], <span class="st">&#39;.&#39;</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;black wins (percentage)&quot;</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;depth of the game&quot;</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative Distribution function of the chance of black to win</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>cdf_wins <span class="op">=</span> <span class="bu">sorted</span>([sample[<span class="st">&quot;black_wins&quot;</span>] <span class="cf">for</span> sample <span class="kw">in</span> data])</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>plt.plot([x<span class="op">/</span><span class="bu">len</span>(cdf_wins) <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(cdf_wins))], cdf_wins)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Cumulative Distribution function of the chance of black to win&quot;</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;</span><span class="sc">% o</span><span class="st">f the samples with a chance of black to win below the y value&quot;</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Chance of black to win&quot;</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;The CDF curve shows that black has more chances to win, globally&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>The CDF curve shows that black has more chances to win, globally
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_bf3cbf9a9e954ad4a7b1e4b93ac65701/a71fc952c1b2afb35ec16e84fe4dceb1bf91a3f7.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_bf3cbf9a9e954ad4a7b1e4b93ac65701/47ae974a4603845587363ca94dfca45d551939fe.png" /></p>
</div>
</div>
<section
id="first-steps-transform-all-the-data-into-numpy-arrays-to-feed-your-neural-network"
class="cell markdown" id="uJn7gQooN1Wq">
<h1>First steps: transform all the data into numpy arrays to feed your
neural network</h1>
<p>Advices:</p>
<ul>
<li>do not use only a 9x9 matrix as input. Use at least two planes to
encode the board. One plane for black and one plane for white (typically
with a 1 if there is a black stone for the first plane and with a 1 if
there is a white stone for the second plane). The dimension of an input
should be at least <code>[2,9,9]</code>. In Torch, the Conv2d method
needs inputs as <code>[NBatch, Channels, H, W]</code>.</li>
<li>consider to enrich your dataset with all symmetries and rotations.
You should be able to multiply the number of samples to consider: any
rotation of the board should have the same score, right?. You can use
<code>np.rot90</code> to rotate your boards be beware of the dimensions
(the channel is not the last dimension), so you may want to use
<code>np.moveaxis()</code> to force the channels to be the last
dimension, then call it again to make it the second one.</li>
<li>what should happen on the score if you switch the colors? To know
which player has to play next, you can check, for a sample, the parity
of the length of the list <code>data[i]["list_of_moves"]</code> (an odd
length list would mean that white is the next player. An even length
list means that black has to play).</li>
<li>work on enlarging and preparing your data only once. Once all you
input data is setup as a big Numpy matrix, you may want to save it for
speeding up everything. You can use, for instance
<code>numpy.rot90()</code> and <code>numpy.flipud()</code> to generate
all the symmetries</li>
</ul>
</section>
<div class="cell markdown">
<p>RENDU</p>
</div>
<div class="cell markdown">
<p>La fonction <code>get_data</code> prépare les données pour
l'apprentissage en :</p>
<ul>
<li><strong>Augmentant la variabilité</strong> : En générant des données
augmentées avec des transformations aléatoires.</li>
<li><strong>Extrait et encode</strong> : Les positions des pierres et
les étiquettes de victoire pour chaque joueur.</li>
<li><strong>Équilibre les classes</strong> : Pour éviter tout biais dans
l'apprentissage.</li>
<li><strong>Mélange les données</strong> : Pour introduire de
l'aléatoire dans l'ordre des échantillons.</li>
</ul>
</div>
<div class="cell code" data-execution_count="5" id="tdT6ucKcN1Wr">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torchvision.transforms <span class="im">as</span> transforms</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> name_to_coord(s):</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> s <span class="op">!=</span> <span class="st">&quot;PASS&quot;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    indexLetters <span class="op">=</span> {<span class="st">&#39;A&#39;</span>:<span class="dv">0</span>, <span class="st">&#39;B&#39;</span>:<span class="dv">1</span>, <span class="st">&#39;C&#39;</span>:<span class="dv">2</span>, <span class="st">&#39;D&#39;</span>:<span class="dv">3</span>, <span class="st">&#39;E&#39;</span>:<span class="dv">4</span>, <span class="st">&#39;F&#39;</span>:<span class="dv">5</span>, <span class="st">&#39;G&#39;</span>:<span class="dv">6</span>, <span class="st">&#39;H&#39;</span>:<span class="dv">7</span>}</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    col <span class="op">=</span> indexLetters[s[<span class="dv">0</span>]]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    lin <span class="op">=</span> <span class="bu">int</span>(s[<span class="dv">1</span>:]) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> col, lin</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>data_transform <span class="op">=</span> transforms.Compose([</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    transforms.RandomRotation(<span class="dv">10</span>),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    transforms.RandomHorizontalFlip(),</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    transforms.RandomVerticalFlip(),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> augment_data(x):</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    augmented_data <span class="op">=</span> []</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>):</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        channels <span class="op">=</span> []</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(x.shape[<span class="dv">0</span>]): </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>            tensor_x <span class="op">=</span> torch.tensor(x[i], dtype<span class="op">=</span>torch.float32)  </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>            tensor_x <span class="op">=</span> tensor_x.unsqueeze(<span class="dv">0</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>            pil_image <span class="op">=</span> transforms.ToPILImage()(tensor_x) </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>            augmented_pil <span class="op">=</span> data_transform(pil_image) </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>            augmented_tensor <span class="op">=</span> transforms.ToTensor()(augmented_pil)  </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>            channels.append(augmented_tensor.squeeze(<span class="dv">0</span>)) </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        augmented_data.append(torch.stack(channels).numpy())  </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> augmented_data</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_data(data):</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    X_black_wins <span class="op">=</span> []</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    Y_black_wins <span class="op">=</span> []</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    X_white_wins <span class="op">=</span> []</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    Y_white_wins <span class="op">=</span> []</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> elt <span class="kw">in</span> data:</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> np.zeros((<span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, stone <span class="kw">in</span> <span class="bu">enumerate</span>(elt[<span class="st">&#39;list_of_moves&#39;</span>]):</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> stone <span class="op">!=</span> <span class="st">&#39;PASS&#39;</span>:</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>                x[i <span class="op">%</span> <span class="dv">2</span>, name_to_coord(stone)[<span class="dv">0</span>], name_to_coord(stone)[<span class="dv">1</span>]] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>        y_black <span class="op">=</span> elt[<span class="st">&#39;black_wins&#39;</span>] <span class="op">/</span> elt[<span class="st">&#39;rollouts&#39;</span>]</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        y_white <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> y_black</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>        augmentations <span class="op">=</span> augment_data(x)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> y_black <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> aug <span class="kw">in</span> augmentations:</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>                X_black_wins.append(aug)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>                Y_black_wins.append([y_black])</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> aug <span class="kw">in</span> augmentations:</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>                X_white_wins.append(aug)</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>                Y_white_wins.append([y_white])</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    len_black_wins <span class="op">=</span> <span class="bu">len</span>(X_black_wins)</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    len_white_wins <span class="op">=</span> <span class="bu">len</span>(X_white_wins)</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> len_black_wins <span class="op">&gt;</span> len_white_wins:</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>        difference <span class="op">=</span> len_black_wins <span class="op">-</span> len_white_wins</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>        additional_white_samples <span class="op">=</span> np.random.choice(len_white_wins, difference, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index <span class="kw">in</span> additional_white_samples:</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>            X_white_wins.append(X_white_wins[index])</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>            Y_white_wins.append(Y_white_wins[index])</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>        difference <span class="op">=</span> len_white_wins <span class="op">-</span> len_black_wins</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>        additional_black_samples <span class="op">=</span> np.random.choice(len_black_wins, difference, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index <span class="kw">in</span> additional_black_samples:</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>            X_black_wins.append(X_black_wins[index])</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>            Y_black_wins.append(Y_black_wins[index])</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>    X_balanced <span class="op">=</span> X_black_wins <span class="op">+</span> X_white_wins</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    Y_balanced <span class="op">=</span> Y_black_wins <span class="op">+</span> Y_white_wins</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>    combined <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(X_balanced, Y_balanced))</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>    np.random.shuffle(combined)</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>    X_balanced, Y_balanced <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>combined)</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(X_balanced), np.array(Y_balanced)</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>X,Y <span class="op">=</span> get_data(data)</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X.shape, Y.shape)</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output stream stdout">
<pre><code>(378240, 2, 8, 8) (378240, 1)
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Spliting the data</p>
</div>
<div class="cell markdown">
<p>Ce code est crucial pour la préparation des données avant
l'entraînement de notre modèle de réseau de neurones:</p>
<ul>
<li><p><strong>Division des données</strong> : Les données sont
segmentées en ensembles d'entraînement, de validation et de
test</p></li>
<li><p><strong>Réorganisation des données</strong> : Les données sont
remodelées pour correspondre au format attendu par PyTorch : chaque
échantillon est une image de taille 8x8 avec 2 canaux.</p></li>
<li><p><strong>Création de jeux de données</strong> : Les données sont
regroupées en jeux de données PyTorch à l'aide de la classe
<code>TensorDataset</code>.</p></li>
<li><p><strong>Création de chargeurs de données</strong> : Des chargeurs
de données (<code>DataLoader</code>) sont créés à partir des jeux de
données. Ces chargeurs permettent d'itérer efficacement sur les données
pendant l'entraînement du modèle.</p></li>
</ul>
</div>
<div class="cell code" data-execution_count="7">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.utils</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> random_split,TensorDataset,DataLoader</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torchsummary <span class="im">import</span> summary</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tqdm</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> <span class="st">&#39;cpu&#39;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>X_train,X_test,Y_train,Y_test <span class="op">=</span> train_test_split(X,Y,test_size<span class="op">=</span><span class="fl">0.33</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>X_train,X_val,Y_train,Y_val <span class="op">=</span> train_test_split(X_train,Y_train,test_size<span class="op">=</span><span class="fl">0.33</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X_train.reshape(X_train.shape[<span class="dv">0</span>],<span class="dv">2</span>,<span class="dv">8</span>,<span class="dv">8</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>X_val <span class="op">=</span> X_val.reshape(X_val.shape[<span class="dv">0</span>],<span class="dv">2</span>,<span class="dv">8</span>,<span class="dv">8</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> X_test.reshape(X_test.shape[<span class="dv">0</span>],<span class="dv">2</span>,<span class="dv">8</span>,<span class="dv">8</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> TensorDataset(torch.from_numpy(X_train).to(device), torch.from_numpy(Y_train).to(device))</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> TensorDataset(torch.from_numpy(X_test).to(device), torch.from_numpy(Y_test).to(device))</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>train_loader <span class="op">=</span> DataLoader(train_data, batch_size<span class="op">=</span><span class="dv">200</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>test_loader <span class="op">=</span> DataLoader(test_data, batch_size<span class="op">=</span><span class="dv">200</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<section id="second-steps-build-your-neural-network-and-train-it"
class="cell markdown" id="KbzFMh-UN1Wr">
<h1>Second steps: build your neural network and train it</h1>
<p>Don't forget to check overfitting, ...</p>
<p><em>advices</em> :</p>
<ul>
<li>you may need to use some of the <code>torch.nn</code> layers:
<code>Linear</code>, <code>Conv2d</code>, <code>ReLU</code>,
<code>LeakyReLU</code>, <code>BatchNorm2d</code>, <code>Flatten</code>,
<code>Dropout</code>... But you can of course first build a very simple
one (and just pick some of them)...</li>
<li>if you use convolution layers, be sure <strong>not to downsize your
board</strong>. Applying a filter should keep the original size of the
board (9x9), otherwise you would somehow forget the stones on the
borders</li>
<li>you will use like 33% of your input sample for validation. However,
the final goal is to score new data that will be given in addition to
the actual data. So, you should use the 33% splitting rule to set up
your network architecture and, once you fixed it, you should train your
final model on the whole set of data, crossing your fingers that it will
generalize well.</li>
<li>Warning: if you run a few epoch, and run it again for some more
epochs, it will not reset the weights and the biases of your neural
network. It's good news because you can add more and more epochs to your
model, but be careful about the training/test sets (do split your sets
before you initialize your model). Or you will be breaking your
validation/training partition!</li>
</ul>
</section>
<div class="cell markdown">
<ul>
<li><strong>Couches de convolution</strong> : Utilisation de
<code>nn.Conv2d</code> pour extraire des caractéristiques spatiales des
images.</li>
<li><strong>Normalisation par lots</strong> :
<code>nn.BatchNorm2d</code> pour stabiliser l'entraînement et améliorer
la généralisation.</li>
<li><strong>Activation ReLU</strong> : <code>nn.ReLU</code> introduit
une non-linéarité pour apprendre des représentations complexes.</li>
<li><strong>Couches entièrement connectées</strong> :
<code>nn.Linear</code> pour la classification finale avec des dimensions
adaptées à la tâche.</li>
<li><strong>Dropout</strong> : <code>nn.Dropout</code> pour réduire le
surajustement en désactivant aléatoirement des neurones.</li>
<li><strong>Activation Sigmoid</strong> : <code>nn.Sigmoid</code>
produit une sortie dans l'intervalle [0, 1] pour la classification
binaire.</li>
</ul>
</div>
<div class="cell code" data-execution_count="8" id="IQ1siAgaN1Ws">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Network(nn.Module):</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(Network, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conv_layers <span class="op">=</span> nn.Sequential(</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">2</span>, <span class="dv">32</span>, kernel_size<span class="op">=</span><span class="dv">3</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>            nn.BatchNorm2d(<span class="dv">32</span>),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">32</span>, <span class="dv">64</span>, kernel_size<span class="op">=</span><span class="dv">3</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>            nn.BatchNorm2d(<span class="dv">64</span>),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>            nn.Conv2d(<span class="dv">64</span>, <span class="dv">128</span>, kernel_size<span class="op">=</span><span class="dv">3</span>, padding<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>            nn.BatchNorm2d(<span class="dv">128</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>            nn.ReLU()</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fc_layers <span class="op">=</span> nn.Sequential(</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">128</span> <span class="op">*</span> <span class="dv">8</span> <span class="op">*</span> <span class="dv">8</span>, <span class="dv">512</span>),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>            nn.Dropout(p<span class="op">=</span><span class="fl">0.5</span>),</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">512</span>, <span class="dv">256</span>),</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>            nn.Dropout(p<span class="op">=</span><span class="fl">0.5</span>),</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">256</span>, <span class="dv">64</span>),</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>            nn.Dropout(p<span class="op">=</span><span class="fl">0.5</span>),</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">64</span>, <span class="dv">32</span>),</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>            nn.ReLU(),</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>            nn.Dropout(p<span class="op">=</span><span class="fl">0.5</span>),</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>            nn.Linear(<span class="dv">32</span>, <span class="dv">1</span>),</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>            nn.Sigmoid()</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.conv_layers(x)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> x.view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">128</span> <span class="op">*</span> <span class="dv">8</span> <span class="op">*</span> <span class="dv">8</span>)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="va">self</span>.fc_layers(x)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> x</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model(model, train_loader, test_loader, optimizer, criterion, num_epochs):</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    train_losses <span class="op">=</span> []</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    test_losses <span class="op">=</span> []</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(num_epochs):</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>        train_loss <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>        test_loss <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>        model.train()</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> inputs, targets <span class="kw">in</span> tqdm.tqdm(train_loader, desc<span class="op">=</span><span class="ss">f&quot;Epoch </span><span class="sc">{</span>epoch<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>num_epochs<span class="sc">}</span><span class="ss"> - Training&quot;</span>):</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>            optimizer.zero_grad()</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>            outputs <span class="op">=</span> model(inputs.<span class="bu">float</span>())</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>            loss <span class="op">=</span> criterion(outputs, targets.<span class="bu">float</span>().unsqueeze(<span class="dv">1</span>))</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>            loss.backward()</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>            optimizer.step()</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>            train_loss <span class="op">+=</span> loss.item()</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>        train_losses.append(train_loss <span class="op">/</span> <span class="bu">len</span>(train_loader))</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>        model.<span class="bu">eval</span>()  </span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>        total_test_samples <span class="op">=</span> <span class="dv">0</span>  </span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> torch.no_grad():</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> inputs, targets <span class="kw">in</span> tqdm.tqdm(test_loader, desc<span class="op">=</span><span class="ss">f&quot;Epoch </span><span class="sc">{</span>epoch<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>num_epochs<span class="sc">}</span><span class="ss"> - Validation&quot;</span>):</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>                outputs <span class="op">=</span> model(inputs.<span class="bu">float</span>())</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>                loss <span class="op">=</span> criterion(outputs, targets.<span class="bu">float</span>().unsqueeze(<span class="dv">1</span>))</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>                test_loss <span class="op">+=</span> loss.item()</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>                total_test_samples <span class="op">+=</span> <span class="bu">len</span>(targets) </span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>        test_losses.append(test_loss <span class="op">/</span> total_test_samples)  </span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&#39;Epoch </span><span class="sc">{</span>epoch <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>num_epochs<span class="sc">}</span><span class="ss">, Train Loss: </span><span class="sc">{</span>train_losses[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">, Test Loss: </span><span class="sc">{</span>test_losses[<span class="op">-</span><span class="dv">1</span>]<span class="sc">:.4f}</span><span class="ss">&#39;</span>)</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> train_losses, test_losses</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</div>
<div class="cell markdown">
<p>La fonction <code>train_model</code> entraîne un modèle de réseau de
neurones sur les données d'entraînement, évalue sa performance sur les
données de test à chaque époque, calcule et affiche les pertes
d'entraînement et de test pour surveiller l'entraînement et évaluer la
performance du modèle.</p>
</div>
<div class="cell markdown">
<p>Preparing the model</p>
</div>
<div class="cell code" data-execution_count="9">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Network()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>criterion <span class="op">=</span> nn.MSELoss()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam(model.parameters())</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>summary(model, (<span class="dv">2</span>,<span class="dv">8</span>,<span class="dv">8</span>), device<span class="op">=</span>device)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>----------------------------------------------------------------
        Layer (type)               Output Shape         Param #
================================================================
            Conv2d-1             [-1, 32, 8, 8]             608
       BatchNorm2d-2             [-1, 32, 8, 8]              64
              ReLU-3             [-1, 32, 8, 8]               0
            Conv2d-4             [-1, 64, 8, 8]          18,496
       BatchNorm2d-5             [-1, 64, 8, 8]             128
              ReLU-6             [-1, 64, 8, 8]               0
            Conv2d-7            [-1, 128, 8, 8]          73,856
       BatchNorm2d-8            [-1, 128, 8, 8]             256
              ReLU-9            [-1, 128, 8, 8]               0
           Linear-10                  [-1, 512]       4,194,816
             ReLU-11                  [-1, 512]               0
          Dropout-12                  [-1, 512]               0
           Linear-13                  [-1, 256]         131,328
             ReLU-14                  [-1, 256]               0
          Dropout-15                  [-1, 256]               0
           Linear-16                   [-1, 64]          16,448
             ReLU-17                   [-1, 64]               0
          Dropout-18                   [-1, 64]               0
           Linear-19                   [-1, 32]           2,080
             ReLU-20                   [-1, 32]               0
          Dropout-21                   [-1, 32]               0
           Linear-22                    [-1, 1]              33
          Sigmoid-23                    [-1, 1]               0
================================================================
Total params: 4,438,113
Trainable params: 4,438,113
Non-trainable params: 0
----------------------------------------------------------------
Input size (MB): 0.00
Forward/backward pass size (MB): 0.35
Params size (MB): 16.93
Estimated Total Size (MB): 17.28
----------------------------------------------------------------
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Training</p>
</div>
<div class="cell code" data-execution_count="10">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>num_epochs <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>train_losses, test_losses <span class="op">=</span> train_model(model, train_loader, test_loader, optimizer, criterion, num_epochs)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>Epoch 1/10 - Training:   0%|                                                                    | 0/849 [00:00&lt;?, ?it/s]/home/msandi/.venv/lib/python3.12/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([200, 1, 1])) that is different to the input size (torch.Size([200, 1])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
  return F.mse_loss(input, target, reduction=self.reduction)
Epoch 1/10 - Training: 100%|█████████████████████████████████████████████████████████▊| 847/849 [00:30&lt;00:00, 20.30it/s]/home/msandi/.venv/lib/python3.12/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([191, 1, 1])) that is different to the input size (torch.Size([191, 1])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
  return F.mse_loss(input, target, reduction=self.reduction)
Epoch 1/10 - Training: 100%|██████████████████████████████████████████████████████████| 849/849 [00:30&lt;00:00, 27.82it/s]
Epoch 1/10 - Validation: 100%|██████████████████████████████████████████████████████▋| 622/625 [00:05&lt;00:00, 102.87it/s]/home/msandi/.venv/lib/python3.12/site-packages/torch/nn/modules/loss.py:535: UserWarning: Using a target size (torch.Size([20, 1, 1])) that is different to the input size (torch.Size([20, 1])). This will likely lead to incorrect results due to broadcasting. Please ensure they have the same size.
  return F.mse_loss(input, target, reduction=self.reduction)
Epoch 1/10 - Validation: 100%|███████████████████████████████████████████████████████| 625/625 [00:05&lt;00:00, 105.31it/s]
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 1/10, Train Loss: 0.0362, Test Loss: 0.0002
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>Epoch 2/10 - Training: 100%|██████████████████████████████████████████████████████████| 849/849 [00:43&lt;00:00, 19.33it/s]
Epoch 2/10 - Validation: 100%|███████████████████████████████████████████████████████| 625/625 [00:05&lt;00:00, 112.21it/s]
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 2/10, Train Loss: 0.0327, Test Loss: 0.0002
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>Epoch 3/10 - Training: 100%|██████████████████████████████████████████████████████████| 849/849 [00:43&lt;00:00, 19.44it/s]
Epoch 3/10 - Validation: 100%|███████████████████████████████████████████████████████| 625/625 [00:05&lt;00:00, 111.08it/s]
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 3/10, Train Loss: 0.0321, Test Loss: 0.0002
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>Epoch 4/10 - Training: 100%|██████████████████████████████████████████████████████████| 849/849 [00:43&lt;00:00, 19.32it/s]
Epoch 4/10 - Validation: 100%|███████████████████████████████████████████████████████| 625/625 [00:05&lt;00:00, 112.46it/s]
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 4/10, Train Loss: 0.0318, Test Loss: 0.0002
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>Epoch 5/10 - Training: 100%|██████████████████████████████████████████████████████████| 849/849 [00:44&lt;00:00, 19.29it/s]
Epoch 5/10 - Validation: 100%|███████████████████████████████████████████████████████| 625/625 [00:05&lt;00:00, 106.68it/s]
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 5/10, Train Loss: 0.0316, Test Loss: 0.0002
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>Epoch 6/10 - Training: 100%|██████████████████████████████████████████████████████████| 849/849 [00:44&lt;00:00, 19.21it/s]
Epoch 6/10 - Validation: 100%|███████████████████████████████████████████████████████| 625/625 [00:05&lt;00:00, 107.85it/s]
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 6/10, Train Loss: 0.0315, Test Loss: 0.0002
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>Epoch 7/10 - Training: 100%|██████████████████████████████████████████████████████████| 849/849 [00:44&lt;00:00, 19.13it/s]
Epoch 7/10 - Validation: 100%|███████████████████████████████████████████████████████| 625/625 [00:05&lt;00:00, 104.54it/s]
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 7/10, Train Loss: 0.0314, Test Loss: 0.0002
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>Epoch 8/10 - Training: 100%|██████████████████████████████████████████████████████████| 849/849 [00:44&lt;00:00, 18.96it/s]
Epoch 8/10 - Validation: 100%|███████████████████████████████████████████████████████| 625/625 [00:05&lt;00:00, 104.27it/s]
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 8/10, Train Loss: 0.0314, Test Loss: 0.0002
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>Epoch 9/10 - Training: 100%|██████████████████████████████████████████████████████████| 849/849 [00:43&lt;00:00, 19.36it/s]
Epoch 9/10 - Validation: 100%|███████████████████████████████████████████████████████| 625/625 [00:05&lt;00:00, 107.06it/s]
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 9/10, Train Loss: 0.0314, Test Loss: 0.0002
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>Epoch 10/10 - Training: 100%|█████████████████████████████████████████████████████████| 849/849 [00:44&lt;00:00, 19.10it/s]
Epoch 10/10 - Validation: 100%|██████████████████████████████████████████████████████| 625/625 [00:05&lt;00:00, 110.29it/s]</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 10/10, Train Loss: 0.0314, Test Loss: 0.0002
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>
</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Saving</p>
</div>
<div class="cell code" data-execution_count="11">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>torch.save(model, <span class="st">&#39;death.pth&#39;</span>)</span></code></pre></div>
</div>
<div class="cell markdown">
<p>Graphe</p>
</div>
<div class="cell code" data-execution_count="15">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>plt.plot(train_losses, label<span class="op">=</span><span class="st">&#39;Train Loss&#39;</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Epoch&#39;</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Loss&#39;</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Train and Test Loss over Epochs&#39;</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bf3cbf9a9e954ad4a7b1e4b93ac65701/6431fba13741006e77e0ad148260dd906c76566f.png" /></p>
</div>
</div>
<section id="last-step" class="cell markdown" id="bVnqHnBqN1Ws">
<h1>Last step</h1>
<p>Prepare your model to predict the set of new data to predict, you
will have only 6 hours to push your predictions.</p>
<p>(may be you would like to express, when guessing the percentage of
wins for blacks, that it should reflect the fact that this score should
be the same for all the symmetries you considered)...</p>
</section>
<div class="cell code" data-execution_count="13" id="39RJHPbmN1Ws">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_raw_data_go():</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39; Returns the set of samples from the local file or download it if it does not exists&#39;&#39;&#39;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> gzip, os.path</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> json</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    raw_samples_file <span class="op">=</span> <span class="st">&quot;positions-to-evaluate-8x8.json.gz&quot;</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.isfile(raw_samples_file):</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;File&quot;</span>, raw_samples_file, <span class="st">&quot;not found, I am downloading it...&quot;</span>, end<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> urllib.request</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        urllib.request.urlretrieve (<span class="st">&quot;https://www.labri.fr/perso/lsimon/static/inge2-ia/positions-to-evaluate-8x8.json.gz&quot;</span>, <span class="st">&quot;positions-to-evaluate-8x8.json.gz&quot;</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot; Done&quot;</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> gzip.<span class="bu">open</span>(<span class="st">&quot;positions-to-evaluate-8x8.json.gz&quot;</span>) <span class="im">as</span> fz:</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(fz.read().decode(<span class="st">&quot;utf-8&quot;</span>))</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> get_raw_data_go()</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;We have&quot;</span>, <span class="bu">len</span>(data),<span class="st">&quot;positions&quot;</span>)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_result_file(newdata):</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39; Exemple de méthode permettant de générer le fichier de resultats demandés. &#39;&#39;&#39;</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;my_predictions.txt&quot;</span>, <span class="st">&quot;w&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> d <span class="kw">in</span> newdata:</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>            prediction <span class="op">=</span> position_predict(d[<span class="st">&quot;black_stones&quot;</span>], d[<span class="st">&quot;white_stones&quot;</span>])</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>            f.write(<span class="bu">str</span>(prediction.item()) <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>create_result_file(data)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>File positions-to-evaluate-8x8.json.gz not found, I am downloading it... Done
We have 1000 positions
</code></pre>
</div>
<div class="output error" data-ename="NameError"
data-evalue="name &#39;position_predict&#39; is not defined">
<pre><code>---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
Cell In[13], line 29
     26             prediction = position_predict(d[&quot;black_stones&quot;], d[&quot;white_stones&quot;])
     27             f.write(str(prediction.item()) + &quot;\n&quot;)
---&gt; 29 create_result_file(data)

Cell In[13], line 26, in create_result_file(newdata)
     24 with open(&quot;my_predictions.txt&quot;, &quot;w&quot;) as f:
     25     for d in newdata:
---&gt; 26         prediction = position_predict(d[&quot;black_stones&quot;], d[&quot;white_stones&quot;])
     27         f.write(str(prediction.item()) + &quot;\n&quot;)

NameError: name &#39;position_predict&#39; is not defined
</code></pre>
</div>
</div>
<div class="cell code">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
</body>
</html>
